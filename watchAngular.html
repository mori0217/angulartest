<html ng-app="watchApp">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<script src="angular.js"></script>
</head>

<body>
	<div ng-controller="cartController">
		<div ng-repeat="item in items">
			<span>{{item.title}}</span>
			<input ng-model="item.quantity">
			<span>{{item.price}}</span>
			<span>{{item.price * item.quantity}}</span>
		</div>
		<div>小計： {{totalCart() }}</div>
		<div>値引： {{bill.discount }}</div>
		<div>合計： {{subtotal() }}</div>
	</div>
<script>
	var watchModule = angular.module("watchApp" , [] );
	watchModule.controller("cartController",
		function ( $scope ){
			$scope.bill =  {};

			$scope.items = [
				{title:"ペイントポット", quantity:8, price:3.95},
				{title:"ポルカドット", quantity:17, price:12.95},
				{title:"ペブル", quantity:5, price:6.95}
			];

			$scope.totalCart = function(){
				var total = 0;
				for (var i = 0, len = $scope.items.length; i < len; i++) {
					total = total + $scope.items[i].price * $scope.items[i].quantity;
				}	
				return total;
			};

			$scope.subtotal = function(){
				return $scope.totalCart() - $scope.bill.discount;
			};

			var calculateDiscount = function(newValue, oldValue, scope){
				$scope.bill.discount = newValue > 100 ? 10 : 0;
			}

			$scope.$watch($scope.totalCart, calculateDiscount);
		});	
</script>

</body>

</html>

